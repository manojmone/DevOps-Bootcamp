
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Explore Monitoring Resoruces</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

<link href="http://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  </head><body>

  <div id="navbar" class="navbar-inverse navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/NutanixWorkshops.svg"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html"> <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Setting up Developer PC and accessing Git</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../devgit/devgit.html">Setting up Developer PC and accessing Git</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../devgit/devgit.html#lab-agenda">Lab Agenda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devgit/devgit.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devgit/devgit.html#getting-the-developer-workstation-ready">Getting the Developer workstation ready</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devgit/devgit.html#working-with-github">Working with Github</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devgit/devgit.html#working-with-our-code-and-publishing-it-to-git">Working with our code and publishing it to Git</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Installing Jenkins and Setting up a Pipeline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../devJenkins/devJenkins.html">Lab 2: Installing Jenkins and Setting up a Pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../devJenkins/devJenkins.html#lab-agenda">Lab Agenda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devJenkins/devJenkins.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devJenkins/devJenkins.html#installing-jenkins">Installing Jenkins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../devJenkins/devJenkins.html#working-with-jenkins-to-build-docker-images">Working with Jenkins to build Docker Images</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devJenkins/devJenkins.html#step-1-launch-jenkins">Step #1 : Launch Jenkins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devJenkins/devJenkins.html#step-2-configure-the-plugins-and-start-building-docker-images">Step #2 : Configure the plugins and start building Docker Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devJenkins/devJenkins.html#step-3-configure-docker-agent">Step #3 : Configure Docker agent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devJenkins/devJenkins.html#step-4-test-the-setup">Step #4 : Test the setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devJenkins/devJenkins.html#working-with-jenkins-pipelines">Working with Jenkins Pipelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devJenkins/devJenkins.html#create-a-new-job">Create a new job</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><p class="caption"><span class="caption-text">Setting up Developer PC and accessing Git</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../devgit/devgit.html">Setting up Developer PC and accessing Git</a></li>
</ul>
<p class="caption"><span class="caption-text">Installing Jenkins and Setting up a Pipeline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../devJenkins/devJenkins.html">Lab 2: Installing Jenkins and Setting up a Pipeline</a></li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="exploring-prometheus-in-karbon">
<span id="explore"></span><h1>Exploring Prometheus in Karbon<a class="headerlink" href="#exploring-prometheus-in-karbon" title="Permalink to this headline">¶</a></h1>
<p>In this section we will explore the <code class="docutils literal notranslate"><span class="pre">ntnx-system</span></code> namespace in a given Nutanix Karbon deployed kubernetes cluster and its resources in terms of Prometheus monitoring</p>
<div class="section" id="node-exporter">
<h2>Node Exporter<a class="headerlink" href="#node-exporter" title="Permalink to this headline">¶</a></h2>
<p>Node exporter is used to export metrics from each of the Kubernetes nodes. So a Kubernetes <a class="reference external" href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/">daemonset</a> is used to accomplish this task.</p>
<p>Daemonset makes sure there is an instance of node-exporter po,zd in each node of the cluster as shown below.</p>
<div class="figure">
<img alt="../_images/node-exporter-daemonset.png" src="../_images/node-exporter-daemonset.png" />
</div>
<p>In case the node-exporter pod fails, the kubernetes control loop will replace it with a new node-exporter pod at all times.
So we are sure that metrics are being collected and uploaded to the Prometheus metrics store.</p>
</div>
<div class="section" id="exploring-prometheus">
<h2>Exploring Prometheus<a class="headerlink" href="#exploring-prometheus" title="Permalink to this headline">¶</a></h2>
<p>We will now check a few metrics that are collected and exposed by Promethues implementation that comes with Karbon deployed kubernetes clusters</p>
<p>Let’s access the Prometheus UI to check for available metrics.</p>
<ol class="arabic">
<li><p class="first">Find the Prometheus Service’s port number using the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>k get svc -n ntnx-system
</pre></div>
</div>
<div class="figure">
<img alt="../_images/prom-svc-port.png" src="../_images/prom-svc-port.png" />
</div>
</li>
<li><p class="first">Now let’s forward Prometheus service’s <code class="docutils literal notranslate"><span class="pre">9090</span></code>  port to your Linux Mint VM to be able to access Prometheus UI.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>k port-forward svc/prometheus-k8s <span class="m">9090</span>:9090 <span class="p">&amp;</span>
</pre></div>
</div>
</li>
<li><p class="first">Now you should be able to access Prometheus UI in your Linux Mint VM using the following URL</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>http://localhost:9090
</pre></div>
</div>
<div class="figure">
<img alt="../_images/prom-splash.png" src="../_images/prom-splash.png" />
</div>
</li>
<li><p class="first">Explore available metrics by selecting <strong>insert metric at cursor</strong> drop-down list. Here you will see a list of available metrics.</p>
</li>
<li><p class="first">Here I will choose <strong>go_memstats_alloc_bytes</strong> metrics and check if I get any data. Note that the query text-box is now populated with the query <strong>go_memstats_alloc_bytes</strong></p>
</li>
<li><p class="first">Click on <strong>Execute</strong>. You will see the results of memory used by each kubernetes resource (pod) as show in the following figure.</p>
<div class="figure">
<img alt="../_images/prom-query.png" src="../_images/prom-query.png" />
</div>
</li>
<li><p class="first">Notice that there is also a <strong>Graph</strong> option in Prometheus GUI for the selected metrics. Click on <strong>Graph</strong> to visualise the chosen metrics.</p>
<div class="figure">
<img alt="../_images/prom-graph.png" src="../_images/prom-graph.png" />
</div>
</li>
<li><p class="first">You can also type in a keyword in the query window and suggestions for available metrics would show. You can see that typing the keyword <code class="docutils literal notranslate"><span class="pre">node</span></code> has brought up all available node based metrics.</p>
<div class="figure">
<img alt="../_images/prom-nodes-search.png" src="../_images/prom-nodes-search.png" />
</div>
</li>
</ol>
<p>In day to day operations, most of the metrics made available in the default implementation of Prometheus in Nutanix Karbon deployed kubernetes clusters. Highlight this fact to a customer during a design workshop.</p>
</div>
<div class="section" id="prometheus-operator">
<h2>Prometheus Operator<a class="headerlink" href="#prometheus-operator" title="Permalink to this headline">¶</a></h2>
<p>As we already know Kubernetes has resources such as deployments and daemonsets (not limited to) for managing stateless applications, Operators are kubernetes extensions that will allow for stateful applications to be managed. As stateful applications need more domain specific knowledge of scaling, upgrading and reconfiguring, operators provide a way of doing this.</p>
<p>Operators can be developed individually or obtained from a community maintaining these.</p>
<p>For example: Prometheus as a stateful application has an operator and popular databases like MS SQL do too.</p>
<p>Nutanix Karbon deployed clusters come with a Prometheus operator and it runs as a <a class="reference external" href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/">replica set</a> maintaining at least one operator pod being alive at any given time. We can use this prometheus operator to deploy a separate instance of Prometheus to collect and maintain metrics from other applications in our Karbon deployed Kubernetes cluster.</p>
<p>A good design would advocate the following for Prometheus implementation: You may come across this design question while working with a customer on a Karbon (DevOps) opportunity. Please take a moment to go through this.</p>
<ol class="arabic simple">
<li>Use the Nutanix deployed prometheus instance to monitor nodes and system namespaces</li>
<li>Deploy separate instances of Prometheus collectors for user applications and user namespaces using the Nutanix deployed prometheus operator</li>
</ol>
<p>A view of this is illustrated in the following diagram:</p>
<div class="figure">
<img alt="../_images/prom-instance-design.png" src="../_images/prom-instance-design.png" />
</div>
<p><strong>Image Source:</strong> <a class="reference external" href="https://miro.medium.com/max/700/1*PK2FdiI5mwLTTOgik0BaJg.png">Prometheus Instances for Kubernetes and Applications</a></p>
<p>Nutanix’s very own DevOps Architect Christophe Jauffret has written a great article <a class="reference external" href="https://medium.com/&#64;christophe_99995/applications-metrics-monitoring-on-nutanix-karbon-c1d1158ebcfc">here</a> to deploy a separate instance of Prometheus to monitor user applications over here. You could recommend this method to a prospective customer.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The steps in the Christophe’s article above will work in your lab environment. This might take up to 45 minutes. Please only do this if you have extra time in this session.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/explore/explore.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2019 Nutanix.<br/>
    </p>
  </div>
</footer>
  </body>
</html>